<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Boost.AFIO: boost::afio::v2::algorithm::shared_fs_mutex::atomic_append Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Boost.AFIO
   &#160;<span id="projectnumber">v2.00 early alpha</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">boost::afio::v2::algorithm::shared_fs_mutex::atomic_append Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Scalable many entity shared/exclusive file system based lock.  
 <a href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="atomic__append_8hpp_source.html">atomic_append.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for boost::afio::v2::algorithm::shared_fs_mutex::atomic_append:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.png" usemap="#boost::afio::v2::algorithm::shared_fs_mutex::atomic_append_map" alt=""/>
  <map id="boost::afio::v2::algorithm::shared_fs_mutex::atomic_append_map" name="boost::afio::v2::algorithm::shared_fs_mutex::atomic_append_map">
<area href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html" title="Abstract base class for an object which protects shared filing system resources. " alt="boost::afio::v2::algorithm::shared_fs_mutex::shared_fs_mutex" shape="rect" coords="0,0,348,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a13d449766b03e86bf4d674594e81b91f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a13d449766b03e86bf4d674594e81b91f"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a> = <a class="el" href="structboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html">shared_fs_mutex::entity_type</a></td></tr>
<tr class="memdesc:a13d449766b03e86bf4d674594e81b91f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of an entity id. <br /></td></tr>
<tr class="separator:a13d449766b03e86bf4d674594e81b91f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff02e08f28cb3fc9e7feb50b955379a3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aff02e08f28cb3fc9e7feb50b955379a3"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#aff02e08f28cb3fc9e7feb50b955379a3">entities_type</a> = <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#ad094c66df0e62a041e1a455acb16ba78">shared_fs_mutex::entities_type</a></td></tr>
<tr class="memdesc:aff02e08f28cb3fc9e7feb50b955379a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of a sequence of entities. <br /></td></tr>
<tr class="separator:aff02e08f28cb3fc9e7feb50b955379a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a86396e3d55a54eb6bd6db5f7115d32d0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a86396e3d55a54eb6bd6db5f7115d32d0"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a86396e3d55a54eb6bd6db5f7115d32d0">atomic_append</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a> &amp;&amp;o) noexcept</td></tr>
<tr class="memdesc:a86396e3d55a54eb6bd6db5f7115d32d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move constructor. <br /></td></tr>
<tr class="separator:a86396e3d55a54eb6bd6db5f7115d32d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca1e76aa07fa42200ce250b32b59b43d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aca1e76aa07fa42200ce250b32b59b43d"></a>
<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#aca1e76aa07fa42200ce250b32b59b43d">operator=</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a> &amp;&amp;o) noexcept</td></tr>
<tr class="memdesc:aca1e76aa07fa42200ce250b32b59b43d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move assign. <br /></td></tr>
<tr class="separator:aca1e76aa07fa42200ce250b32b59b43d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a438c289652dca49c56f634311f01394a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a438c289652dca49c56f634311f01394a"></a>
const <a class="el" href="classboost_1_1afio_1_1v2_1_1file__handle.html">file_handle</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a438c289652dca49c56f634311f01394a">handle</a> () const  noexcept</td></tr>
<tr class="memdesc:a438c289652dca49c56f634311f01394a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the handle to file being used for this lock. <br /></td></tr>
<tr class="separator:a438c289652dca49c56f634311f01394a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae468ca5ac9ef271255b64ba22d4a751c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae468ca5ac9ef271255b64ba22d4a751c"></a>
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#ae468ca5ac9ef271255b64ba22d4a751c">unlock</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#aff02e08f28cb3fc9e7feb50b955379a3">entities_type</a> entities, unsigned long long hint) noexcept override final</td></tr>
<tr class="memdesc:ae468ca5ac9ef271255b64ba22d4a751c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock a previously locked sequence of entities. <br /></td></tr>
<tr class="separator:ae468ca5ac9ef271255b64ba22d4a751c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb4d62ece5260d6d07a950db3378f853"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adb4d62ece5260d6d07a950db3378f853"></a>
<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#adb4d62ece5260d6d07a950db3378f853">entity_from_buffer</a> (const char *buffer, size_t bytes, bool exclusive=true) noexcept</td></tr>
<tr class="memdesc:adb4d62ece5260d6d07a950db3378f853"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates an entity id from a sequence of bytes. <br /></td></tr>
<tr class="separator:adb4d62ece5260d6d07a950db3378f853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92943c98934f09f66b64f708c895cf4f"><td class="memTemplParams" colspan="2"><a class="anchor" id="a92943c98934f09f66b64f708c895cf4f"></a>
template&lt;typename T &gt; </td></tr>
<tr class="memitem:a92943c98934f09f66b64f708c895cf4f"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a92943c98934f09f66b64f708c895cf4f">entity_from_string</a> (const std::basic_string&lt; T &gt; &amp;str, bool exclusive=true) noexcept</td></tr>
<tr class="memdesc:a92943c98934f09f66b64f708c895cf4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates an entity id from a string. <br /></td></tr>
<tr class="separator:a92943c98934f09f66b64f708c895cf4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe956d1160f89da5504f990f5acbcd23"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afe956d1160f89da5504f990f5acbcd23"></a>
<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afe956d1160f89da5504f990f5acbcd23">random_entity</a> (bool exclusive=true) noexcept</td></tr>
<tr class="memdesc:afe956d1160f89da5504f990f5acbcd23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a cryptographically random entity id. <br /></td></tr>
<tr class="separator:afe956d1160f89da5504f990f5acbcd23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bbfb8932c81a7873b1d6d4de920a2cd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3bbfb8932c81a7873b1d6d4de920a2cd"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a3bbfb8932c81a7873b1d6d4de920a2cd">fill_random_entities</a> (span&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a> &gt; seq, bool exclusive=true) noexcept</td></tr>
<tr class="memdesc:a3bbfb8932c81a7873b1d6d4de920a2cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills a sequence of entity ids with cryptographic randomness. Much faster than calling <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afe956d1160f89da5504f990f5acbcd23" title="Generates a cryptographically random entity id. ">random_entity()</a> individually. <br /></td></tr>
<tr class="separator:a3bbfb8932c81a7873b1d6d4de920a2cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a360d0f60804266008cd05efcc09f0d2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a360d0f60804266008cd05efcc09f0d2c"></a>
result&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a360d0f60804266008cd05efcc09f0d2c">lock</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#aff02e08f28cb3fc9e7feb50b955379a3">entities_type</a> entities, <a class="el" href="structboost_1_1afio_1_1v2_1_1deadline.html">deadline</a> d=<a class="el" href="structboost_1_1afio_1_1v2_1_1deadline.html">deadline</a>(), bool spin_not_sleep=false) noexcept</td></tr>
<tr class="memdesc:a360d0f60804266008cd05efcc09f0d2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock all of a sequence of entities for exclusive or shared access. <br /></td></tr>
<tr class="separator:a360d0f60804266008cd05efcc09f0d2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea2fe767c1becf4b9ae49b3ce1390430"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aea2fe767c1becf4b9ae49b3ce1390430"></a>
result&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#aea2fe767c1becf4b9ae49b3ce1390430">lock</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a> entity, <a class="el" href="structboost_1_1afio_1_1v2_1_1deadline.html">deadline</a> d=<a class="el" href="structboost_1_1afio_1_1v2_1_1deadline.html">deadline</a>(), bool spin_not_sleep=false) noexcept</td></tr>
<tr class="memdesc:aea2fe767c1becf4b9ae49b3ce1390430"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock a single entity for exclusive or shared access. <br /></td></tr>
<tr class="separator:aea2fe767c1becf4b9ae49b3ce1390430"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5153b5af3549290acc336007c8f59bd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5153b5af3549290acc336007c8f59bd"></a>
result&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#ae5153b5af3549290acc336007c8f59bd">try_lock</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#aff02e08f28cb3fc9e7feb50b955379a3">entities_type</a> entities) noexcept</td></tr>
<tr class="memdesc:ae5153b5af3549290acc336007c8f59bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to lock all of a sequence of entities for exclusive or shared access. <br /></td></tr>
<tr class="separator:ae5153b5af3549290acc336007c8f59bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85bd8c532cef9eefc2722d67c3fb134e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a85bd8c532cef9eefc2722d67c3fb134e"></a>
result&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a85bd8c532cef9eefc2722d67c3fb134e">try_lock</a> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#a13d449766b03e86bf4d674594e81b91f">entity_type</a> entity) noexcept</td></tr>
<tr class="memdesc:a85bd8c532cef9eefc2722d67c3fb134e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to lock a single entity for exclusive or shared access. <br /></td></tr>
<tr class="separator:a85bd8c532cef9eefc2722d67c3fb134e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ade3d31cacb2f40752b85ea01e3bc745c"><td class="memItemLeft" align="right" valign="top">static result&lt; <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html#ade3d31cacb2f40752b85ea01e3bc745c">fs_mutex_append</a> (file_handle::path_type lockfile, bool nfs_compatibility=false, bool skip_hashing=false) noexcept</td></tr>
<tr class="separator:ade3d31cacb2f40752b85ea01e3bc745c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a5c134e951e26e754f5e842e0457a538e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5c134e951e26e754f5e842e0457a538e"></a>
virtual result&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>_lock</b> (<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &amp;out, <a class="el" href="structboost_1_1afio_1_1v2_1_1deadline.html">deadline</a> d, bool spin_not_sleep) noexcept override final</td></tr>
<tr class="separator:a5c134e951e26e754f5e842e0457a538e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Scalable many entity shared/exclusive file system based lock. </p>
<p>Lock files and byte ranges scale poorly to the number of items being concurrently locked with typically an exponential drop off in performance as the number of items being concurrently locked rises. This file system algorithm solves this problem using IPC via a shared append-only lock file.</p>
<ul>
<li>Compatible with networked file systems (NFS too if the special nfs_compatibility flag is true. Note turning this on is not free of cost if you don't need NFS compatibility).</li>
<li>Nearly constant time to number of entities being locked.</li>
<li>Nearly constant time to number of processes concurrently using the lock (i.e. number of waiters).</li>
<li>Can sleep until a lock becomes free in a power-efficient manner.</li>
<li>Sudden power loss during use is recovered from.</li>
</ul>
<p>Caveats:</p><ul>
<li>Much slower than <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1byte__ranges.html" title="Many entity shared/exclusive file system based lock. ">byte_ranges</a> for few waiters or small number of entities.</li>
<li>Sudden process exit with locks held will deadlock all other users.</li>
<li>Maximum of twelve entities may be locked concurrently.</li>
<li>Wasteful of disk space if used on a non-extents based filing system (e.g. FAT32, ext3). It is best used in <code>/tmp</code> if possible. If you really must use a non-extents based filing system, destroy and recreate the object instance periodically to force resetting the lock file's length to zero.</li>
<li>Similarly older operating systems (e.g. Linux &lt; 3.0) do not implement extent hole punching and therefore will also see excessive disk space consumption. Note at the time of writing OS X doesn't implement hole punching at all.</li>
<li>If your OS doesn't have sane byte range locks (OS X, BSD, older Linuxes) and multiple objects in your process use the same lock file, misoperation will occur. Use <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1lock__files.html" title="Many entity exclusive compatibility file system based lock. ">lock_files</a> instead.</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd><p class="startdd">Implement hole punching once I port that code from AFIO v1. </p>
<p class="enddd">Decide on some resolution mechanism for sudden process exit. </p>
</dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ade3d31cacb2f40752b85ea01e3bc745c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static result&lt;<a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a>&gt; boost::afio::v2::algorithm::shared_fs_mutex::atomic_append::fs_mutex_append </td>
          <td>(</td>
          <td class="paramtype">file_handle::path_type&#160;</td>
          <td class="paramname"><em>lockfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>nfs_compatibility</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>skip_hashing</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Initialises a shared filing system mutex using the file at <em>lockfile</em> </p>
<dl class="section return"><dt>Returns</dt><dd>An implementation of <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html" title="Abstract base class for an object which protects shared filing system resources. ">shared_fs_mutex</a> using the <a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html" title="Scalable many entity shared/exclusive file system based lock. ">atomic_append</a> algorithm. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lockfile</td><td>The path to the file to use for IPC. </td></tr>
    <tr><td class="paramname">nfs_compatibility</td><td>Make this true if the lockfile could be accessed by NFS. </td></tr>
    <tr><td class="paramname">skip_hashing</td><td>Some filing systems (typically the copy on write ones e.g. ZFS, btrfs) guarantee atomicity of updates and therefore torn writes are never observed by readers. For these, hashing can be safely disabled. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        BOOST_AFIO_LOG_FUNCTION_CALL(0);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        BOOST_OUTCOME_FILTER_ERROR(ret, <a class="code" href="classboost_1_1afio_1_1v2_1_1file__handle.html#a3d1da41b445281b1dfc1da989a7b52c2">file_handle::file</a>(std::move(lockfile), <a class="code" href="classboost_1_1afio_1_1v2_1_1handle.html#a3a41cb212269b4f786fe239568359a47aefb2a684e4afb7d55e6147fbe5a332ee">file_handle::mode::write</a>, file_handle::creation::if_needed, <a class="code" href="classboost_1_1afio_1_1v2_1_1handle.html#aee91cd29de550a15e854459cf67583d1ad5197d93c063a2b1e22d1630a39b7aef">file_handle::caching::temporary</a>, file_handle::flag::delete_on_close));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        atomic_append_detail::header header;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Lock the entire header for exclusive access</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keyword">auto</span> lockresult = ret.try_lock(0, <span class="keyword">sizeof</span>(header), <span class="keyword">true</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>(lockresult.has_error())</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          <span class="keywordflow">if</span>(lockresult.get_error().value() != ETIMEDOUT)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">return</span> lockresult.get_error();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <span class="comment">// Somebody else is also using this file</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          <span class="comment">// I am the first person to be using this (stale?) file, so write a new header and truncate</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          ret.truncate(<span class="keyword">sizeof</span>(header));</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          memset(&amp;header, 0, <span class="keyword">sizeof</span>(header));</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          header.time_offset = stl11::chrono::system_clock::to_time_t(stl11::chrono::system_clock::now());</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          header.first_known_good = <span class="keyword">sizeof</span>(header);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          header.first_after_hole_punch = <span class="keyword">sizeof</span>(header);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <span class="keywordflow">if</span>(!skip_hashing)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            header.hash = <a class="code" href="classboost_1_1afio_1_1v2_1_1utils_1_1fast__hash.html#a6a6a66eabc40d678bb4e7d74be1a1da0">utils::fast_hash::hash</a>(((<span class="keywordtype">char</span> *) &amp;header) + 16, <span class="keyword">sizeof</span>(header) - 16);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          BOOST_OUTCOME_FILTER_ERROR(_, ret.write(0, (<span class="keywordtype">char</span> *) &amp;header, <span class="keyword">sizeof</span>(header)));</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          (void) _;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// Open a shared lock on last byte in header to prevent other users zomping the file</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        BOOST_OUTCOME_FILTER_ERROR(guard, ret.lock(<span class="keyword">sizeof</span>(header) - 1, 1, <span class="keyword">false</span>));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">// Unlock any exclusive lock I gained earlier now</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span>(lockresult)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          lockresult.get().unlock();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">// The constructor will read and cache the header</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">return</span> atomic_append(std::move(ret), std::move(guard), nfs_compatibility, skip_hashing);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      }</div>
<div class="ttc" id="classboost_1_1afio_1_1v2_1_1handle_html_aee91cd29de550a15e854459cf67583d1ad5197d93c063a2b1e22d1630a39b7aef"><div class="ttname"><a href="classboost_1_1afio_1_1v2_1_1handle.html#aee91cd29de550a15e854459cf67583d1ad5197d93c063a2b1e22d1630a39b7aef">boost::afio::v2::handle::caching::temporary</a></div><div class="ttdoc">Cache reads and writes of data and metadata so they complete immediately, only sending any updates to...</div></div>
<div class="ttc" id="classboost_1_1afio_1_1v2_1_1file__handle_html_a3d1da41b445281b1dfc1da989a7b52c2"><div class="ttname"><a href="classboost_1_1afio_1_1v2_1_1file__handle.html#a3d1da41b445281b1dfc1da989a7b52c2">boost::afio::v2::file_handle::file</a></div><div class="ttdeci">static result&lt; file_handle &gt; file(path_type _path, mode _mode=mode::read, creation _creation=creation::open_existing, caching _caching=caching::all, flag flags=flag::none) noexcept</div></div>
<div class="ttc" id="classboost_1_1afio_1_1v2_1_1utils_1_1fast__hash_html_a6a6a66eabc40d678bb4e7d74be1a1da0"><div class="ttname"><a href="classboost_1_1afio_1_1v2_1_1utils_1_1fast__hash.html#a6a6a66eabc40d678bb4e7d74be1a1da0">boost::afio::v2::utils::fast_hash::hash</a></div><div class="ttdeci">static uint128 hash(const char *data, size_t bytes, uint128 seed=uint128(nullptr)) noexcept</div><div class="ttdoc">Single shot hash of a sequence of bytes. </div></div>
<div class="ttc" id="classboost_1_1afio_1_1v2_1_1handle_html_a3a41cb212269b4f786fe239568359a47aefb2a684e4afb7d55e6147fbe5a332ee"><div class="ttname"><a href="classboost_1_1afio_1_1v2_1_1handle.html#a3a41cb212269b4f786fe239568359a47aefb2a684e4afb7d55e6147fbe5a332ee">boost::afio::v2::handle::mode::write</a></div><div class="ttdoc">Ability to read and write (READ_CONTROL|FILE_READ_DATA|FILE_READ_ATTRIBUTES|FILE_READ_EA|FILE_WRITE_D...</div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/boost/afio/v2/algorithm/shared_fs_mutex/<a class="el" href="atomic__append_8hpp_source.html">atomic_append.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceboost.html">boost</a></li><li class="navelem"><a class="el" href="namespaceboost_1_1afio.html">afio</a></li><li class="navelem"><a class="el" href="namespaceboost_1_1afio_1_1v2.html">v2</a></li><li class="navelem"><a class="el" href="namespaceboost_1_1afio_1_1v2_1_1algorithm.html">algorithm</a></li><li class="navelem"><a class="el" href="namespaceboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex.html">shared_fs_mutex</a></li><li class="navelem"><a class="el" href="classboost_1_1afio_1_1v2_1_1algorithm_1_1shared__fs__mutex_1_1atomic__append.html">atomic_append</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
